<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>History</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; max-width: 900px; }
      nav a { margin-right: 1rem; }
      table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
      td, th { border: 1px solid #ddd; padding: 0.5rem; }
      th { background: #f5f5f5; text-align: left; }
    </style>
  </head>
  <body>
    <h1>Session History</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/session">Session</a>
      <a href="/schedule">Schedule</a>
      <a href="/history">History</a>
    </nav>

    <button id="refreshBtn">Refresh</button>
    <table>
      <thead>
        <tr>
          <th>Session ID</th>
          <th>Started</th>
          <th>Ended</th>
          <th>Duration (min)</th>
          <th>Productivity</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr><td colspan="5">Loading...</td></tr>
      </tbody>
    </table>

    <script>
      async function loadSessions() {
        const rows = document.getElementById('rows');
        rows.innerHTML = '<tr><td colspan="5">Loading...</td></tr>';
        try {
          const res = await fetch('/sessions?limit=50');
          const data = await res.json();
          if (!data.sessions || data.sessions.length === 0) {
            rows.innerHTML = '<tr><td colspan="5">No sessions yet.</td></tr>';
            return;
          }

          rows.innerHTML = '';
          for (const session of data.sessions) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${session.id}</td>
              <td>${session.start_time || '-'}</td>
              <td>${session.end_time || '-'}</td>
              <td>${(session.duration_minutes || 0).toFixed(2)}</td>
              <td>${Math.round((session.productivity_score || 0) * 100)}%</td>
            `;
            rows.appendChild(tr);
          }
        } catch (err) {
          rows.innerHTML = `<tr><td colspan="5">Failed to load sessions: ${err.message}</td></tr>`;
        }
      }

      document.getElementById('refreshBtn').addEventListener('click', loadSessions);
      loadSessions();
    </script>
  </body>
</html>
