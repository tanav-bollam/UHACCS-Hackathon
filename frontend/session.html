<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Session</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 2rem; max-width: 800px; }
      nav a { margin-right: 1rem; }
      button { margin-right: 0.5rem; padding: 0.6rem 1rem; }
      pre { background: #f5f5f5; padding: 1rem; border-radius: 8px; }
    </style>
  </head>
  <body>
    <h1>Study Session</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/session">Session</a>
      <a href="/schedule">Schedule</a>
      <a href="/history">History</a>
    </nav>

    <p>Start and stop a live session connected to the backend.</p>
    <button id="startBtn">Start Session</button>
    <button id="stopBtn">Stop Session</button>
    <button id="recommendBtn">Get Recommendation</button>
    <p>Current session ID: <strong id="sessionId">None</strong></p>
    <pre id="output">No session events yet.</pre>

    <script>
      let sessionId = null;
      const sessionIdEl = document.getElementById('sessionId');
      const output = document.getElementById('output');

      const setOutput = (data) => output.textContent = JSON.stringify(data, null, 2);

      document.getElementById('startBtn').addEventListener('click', async () => {
        const res = await fetch('/session/start', { method: 'POST' });
        const data = await res.json();
        sessionId = data.session_id;
        sessionIdEl.textContent = sessionId;
        setOutput(data);
      });

      document.getElementById('stopBtn').addEventListener('click', async () => {
        if (!sessionId) return setOutput({ error: 'Start a session first.' });
        const res = await fetch('/session/stop', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ session_id: sessionId })
        });
        const data = await res.json();
        setOutput(data);
        sessionId = null;
        sessionIdEl.textContent = 'None';
      });

      document.getElementById('recommendBtn').addEventListener('click', async () => {
        const query = sessionId ? `?session_id=${sessionId}` : '';
        const res = await fetch(`/recommendation${query}`);
        const data = await res.json();
        setOutput(data);
      });
    </script>
  </body>
</html>
